Intro
-----

When smtp client has a message to transmit, it establishes a two way transmission channel to a smtp server. 
The responsibility of an smtp client is to transfer the mail message to one or more smtp servers, or reports its failure to do so. 

Smtp client determines the addess of an appropirate host running an smtp server by resolving a destination domain name to either an intermediate mail exchange host or final target host. 

Smtp commands are generated by the smtp client and sent to the smtp server. 
Smtp replies are sent from the smtp server to smtp client. 

Once the server has issued a success response at the end of the mail data, a formal handoff of responsibility occurs. 
The protocol requires that the server must accept responsibility for either delivering the message or properly reporting a failure to do so.

Once the transmission channel is established and initial handshaking is completed, smtp client initiates the mail transation.
Mail transaction consists of a series of commands to specify the orginator and designation of the message. 

The server responds to each command with a reply. 
Replies may indicate the command was accepted, that additional commands are expected, or error. 

Once a given mail has been transmitted , the client may either request that the connection be closed or may initiate other mail transactions.
In addition, SMTP client may use a connection to SMTP server for ancillary services such as verification of email addresses or retrival of mail list subscriber addresses. 

Usually, intermediate hosts are determined via the DNS MX record not by explicit source routing. 


Mail Object
------------

Smtp transports a mail object. 
A mail object contains an envelope and content.

Smtp envelope is sent as a series of smtp protocol units and consists:
1) Originator address,
2) Recipient address, and 
3) <any optional protocol extensions>

Smtp content is sent in the smtp DATA protocol unit and has 2 parts:
1) header 
2) body


Mail Agents and Message Stores
------------------------------
Smtp sessions are stateful with both parties carefully maintaining a common view of the current state. 
State is modeled using a virtual buffer and a state table. 
Client can request the server to reset the buffer or refresh the state table.

There are 4 types of smtp systems, based on the roles those systems play:
1) Orginating system
2) Delivery system
3) Relay system
4) Gateway system

An orginating system introduces mail into the mail system. 

A delivery system is one that receives mail and deposite it in a message store.

A relay system receives mail from a client and transmits it to another server. 

A gateway system receives mail from a client system in one transport environment and transmits it to a server system in another environment. 
Firewalls that rewrite addresses should be considered as gateways even if smtp is used on both sides of them.

  
